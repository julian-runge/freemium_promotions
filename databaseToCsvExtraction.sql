
-- EXPORT FULL CROSS-SECTION
EXPORT
	(
select
	hash_md5(concat(unique_id,'--------------')) HASHED_UNIQUE_ID,
	TREATMENT,
	INSTALL_DATE,
	INSTALL_TS,
	WEEKDAY_INSTALL,
	COUNTRY,
	MOBILE_SOURCE,
	MOBILE_SOURCE_DETAIL,
	DEVICE,
	DEVICE_MODEL,
	INITIAL_LANGUAGE,
	LATEST_LANGUAGE,
	DEVICE_RAM,
	X_RESOLUTION,
	Y_RESOLUTION,
	DPI,
	PORTFOLIO_D30DEVREV,
	PORTFOLIO_D30REV,
	PORTFOLIO_D30ROUNDS,
	LVL1_COMPLETE_TS,
	LVL1PLUS_COMPLETE_TS,
	LVL1_COMPLETE,
	DAYS_COMPLETE_LVL1,
	ACTIVE_DAYS_LVL1,
	SESSIONS_LVL1,
	ACTIVE_HOURS_LVL1,
	SECONDS_LVL1,
	ROUNDS_LVL1,
	ADS_LVL1,
	PURCHASES_LVL1,
	REVENUE_LVL1,
	COINS_BOUGHT_LVL1,
	CASH_BOUGHT_LVL1,
	COINS_SPENT_LVL1,
	CASH_SPENT_LVL1,
	MIN_COINS_LVL1,
	MIN_CASH_LVL1,
	MAX_COINS_LVL1,
	MAX_CASH_LVL1,
	AVG_COINS_LVL1,
	AVG_CASH_LVL1,
	MEDIAN_COINS_LVL1,
	MEDIAN_CASH_LVL1,
	MIN_COINS,
	MIN_CASH,
	MAX_COINS,
	MAX_CASH,
	AVG_COINS,
	AVG_CASH,
	MEDIAN_COINS,
	MEDIAN_CASH,
	CONVERSION_TS,
	CONVERSION_LVL1,
	SESSIONS,
	SECONDS_IN_GAME,
	ROUNDS_PLAYED,
	ACTIVE_HOURS,
	ACTIVE_DAYS,
	ADS,
	REVENUE,
	PURCHASES,
	PROMO_REVENUE,
	PROMO_PURCHASES,
	SHOP_REVENUE,
	SHOP_PURCHASES,
	DAYS_FIRST_PROMO_OFFER,
	DAYS_FIRST_PURCHASE,
	DAYS_FIRST_PROMO_PURCHASE,
	DAYS_FIRST_SHOP_PURCHASE,
	TIME_FINISH_SCENE,
	SCORE_EARNED,
	BADGES_EARNED,
	SCENE_MASTERY,
	SCENES_COMPLETED,
	DISTINCT_SCENES_PLAYED,
	TOTAL_BADGES,
	MAXIMIZER,
	PORTFOLIO_REVENUE,
	PORTFOLIO_PURCHASES,
	PORTFOLIO_ACTIVE_HOURS,
	PORTFOLIO_SESSIONS,
	COINS_BOUGHT_NORMAL,
	CASH_BOUGHT_NORMAL,
	COINS_BOUGHT_LOW,
	CASH_BOUGHT_LOW,
	COINS_SPENT,
	CASH_SPENT,
	CONVERSION,
	REQUESTS_SENT,
	AD_REVENUE,
	INTERSTITIAL_ADS,
	VIDEO_ADS
from x_xsection
)
INTO LOCAL CSV
FILE '/x_xsection.csv'	
COLUMN SEPARATOR=';'
--ENCODING='Latin-1'
WITH COLUMN NAMES;

-- EXPORT "CLEAN" PANEL OF USERS WHO WERE TREATED
EXPORT
	(
select
	CREATED_DATE,
	T_DAY,
	DAY_OF_WEEK,
	hash_md5(concat(unique_id,'--------------')) HASHED_UNIQUE_ID,
	TREATMENT,
	MAXIMIZER,
	DAYS_FIRST_PROMO_OFFER,
	INSTALL_TS,
	WEEKDAY_INSTALL,
	COUNTRY,
	MOBILE_SOURCE_DETAIL,
	DEVICE_MODEL,
	INITIAL_LANGUAGE,
	LATEST_LANGUAGE,
	DEVICE_RAM,
	X_RESOLUTION,
	Y_RESOLUTION,
	DPI,
	LVL1_COMPLETE_TS,
	LVL1PLUS_COMPLETE_TS,
	DAYS_COMPLETE_LVL1,
	ACTIVE_DAYS_LVL1,
	SESSIONS_LVL1,
	ACTIVE_HOURS_LVL1,
	SECONDS_LVL1,
	ROUNDS_LVL1,
	ADS_LVL1,
	PURCHASES_LVL1,
	REVENUE_LVL1,
	COINS_BOUGHT_LVL1,
	CASH_BOUGHT_LVL1,
	COINS_SPENT_LVL1,
	CASH_SPENT_LVL1,
	CONVERSION_LVL1,
	SESSIONS,
	ACTIVE_HOURS,
	ROUNDS_PLAYED,
	SECONDS_IN_GAME,
	ADS,
	PURCHASES,
	REVENUE,
	PROMO_PURCHASES,
	PROMO_REVENUE,
	SHOP_PURCHASES,
	SHOP_REVENUE,
	PROMO_DAY,
	PROMO_OFFER,
	COINS_BOUGHT_NORMAL,
	CASH_BOUGHT_NORMAL,
	COINS_BOUGHT_LOW,
	CASH_BOUGHT_LOW,
	COINS_SPENT,
	CASH_SPENT,
	AVG_COINS,
	AVG_CASH,
	MEDIAN_COINS,
	MEDIAN_CASH,
	TIME_FINISH_SCENE,
	SCORE_EARNED,
	BADGES_EARNED,
	SCENE_MASTERY,
	MIN_SCENE,
	MAX_SCENE,
	SCENES_COMPLETED,
	DISTINCT_SCENES_PLAYED,
	PORTFOLIO_SESSIONS,
	PORTFOLIO_ACTIVE_HOURS,
	PORTFOLIO_PURCHASES,
	PORTFOLIO_REVENUE,
	LAST_ACTIVE,
	FIRST_PURCHASE,
	CONVERSION
from
	x_panel
where
	unique_id in (select distinct unique_id from x_xsection where lvl1_complete=1)
order by
	unique_id,t_day
)
INTO LOCAL CSV
FILE '/x_panel_treated.csv'	
COLUMN SEPARATOR=';'
--ENCODING='Latin-1'
WITH COLUMN NAMES;

-- EXPORT FULL PANEL
EXPORT
	(
select
	CREATED_DATE,
	T_DAY,
	DAY_OF_WEEK,
	hash_md5(concat(unique_id,'--------------')) HASHED_UNIQUE_ID,
	TREATMENT,
	MAXIMIZER,
	DAYS_FIRST_PROMO_OFFER,
	INSTALL_TS,
	WEEKDAY_INSTALL,
	COUNTRY,
	MOBILE_SOURCE_DETAIL,
	DEVICE_MODEL,
	INITIAL_LANGUAGE,
	LATEST_LANGUAGE,
	DEVICE_RAM,
	X_RESOLUTION,
	Y_RESOLUTION,
	DPI,
	LVL1_COMPLETE_TS,
	LVL1PLUS_COMPLETE_TS,
	DAYS_COMPLETE_LVL1,
	ACTIVE_DAYS_LVL1,
	SESSIONS_LVL1,
	ACTIVE_HOURS_LVL1,
	SECONDS_LVL1,
	ROUNDS_LVL1,
	ADS_LVL1,
	PURCHASES_LVL1,
	REVENUE_LVL1,
	COINS_BOUGHT_LVL1,
	CASH_BOUGHT_LVL1,
	COINS_SPENT_LVL1,
	CASH_SPENT_LVL1,
	CONVERSION_LVL1,
	SESSIONS,
	ACTIVE_HOURS,
	ROUNDS_PLAYED,
	SECONDS_IN_GAME,
	ADS,
	PURCHASES,
	REVENUE,
	PROMO_PURCHASES,
	PROMO_REVENUE,
	SHOP_PURCHASES,
	SHOP_REVENUE,
	PROMO_DAY,
	PROMO_OFFER,
	COINS_BOUGHT_NORMAL,
	CASH_BOUGHT_NORMAL,
	COINS_BOUGHT_LOW,
	CASH_BOUGHT_LOW,
	COINS_SPENT,
	CASH_SPENT,
	AVG_COINS,
	AVG_CASH,
	MEDIAN_COINS,
	MEDIAN_CASH,
	TIME_FINISH_SCENE,
	SCORE_EARNED,
	BADGES_EARNED,
	SCENE_MASTERY,
	MIN_SCENE,
	MAX_SCENE,
	SCENES_COMPLETED,
	DISTINCT_SCENES_PLAYED,
	PORTFOLIO_SESSIONS,
	PORTFOLIO_ACTIVE_HOURS,
	PORTFOLIO_PURCHASES,
	PORTFOLIO_REVENUE,
	LAST_ACTIVE,
	FIRST_PURCHASE,
	CONVERSION
from
	x_panel
order by
	unique_id,t_day
)
INTO LOCAL CSV
FILE '/x_panel.csv'	
COLUMN SEPARATOR=';'
--ENCODING='Latin-1'
WITH COLUMN NAMES;
